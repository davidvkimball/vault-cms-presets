/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(
  // If the importer is in node compatibility mode or this is not an ESM
  // file that has been converted to a CommonJS file using a Babel-
  // compatible transform (i.e. "__esModule" has not been set), then set
  // "default" to the CommonJS "module.exports" for node compatibility.
  isNodeMode || !mod || !mod.__esModule ? __defProp(target, "default", { value: mod, enumerable: true }) : target,
  mod
));
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => FileNameHistoryPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian4 = require("obsidian");

// src/settings.ts
var DEFAULT_SETTINGS = {
  historyPropertyName: "aliases",
  ignoreRegexes: ["^_", "^Untitled$", "^Untitled \\d+$"],
  timeoutSeconds: 5,
  caseSensitive: false,
  autoCreateFrontmatter: true,
  includeFolders: [],
  excludeFolders: [],
  fileExtensions: ["md"],
  trackFolderRenames: "",
  excludePropertyName: ""
};

// src/ui/settings-tab.ts
var import_obsidian2 = require("obsidian");

// src/utils/settings-compat.ts
var import_obsidian = require("obsidian");
var Obsidian = __toESM(require("obsidian"), 1);
function createSettingsGroup(containerEl, heading, manifestId) {
  if ((0, import_obsidian.requireApiVersion)("1.11.0")) {
    const ObsidianTyped = Obsidian;
    const SettingGroupCtor = ObsidianTyped.SettingGroup;
    const group = new SettingGroupCtor(containerEl);
    if (heading) {
      group.setHeading(heading);
    }
    return {
      addSetting(cb) {
        group.addSetting(cb);
      }
    };
  } else {
    if (manifestId) {
      containerEl.addClass(`${manifestId}-settings-compat`);
    }
    const groupEl = containerEl.createDiv("setting-group");
    if (heading) {
      const headingEl = groupEl.createDiv("setting-group-heading");
      headingEl.createEl("h3", { text: heading });
    }
    return {
      addSetting(cb) {
        const setting = new import_obsidian.Setting(groupEl);
        cb(setting);
      }
    };
  }
}

// src/ui/settings-tab.ts
var FileNameHistorySettingTab = class extends import_obsidian2.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.icon = "lucide-forward";
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    const saveSettings = () => {
      void this.plugin.saveSettings();
    };
    const generalGroup = createSettingsGroup(containerEl, void 0, "file-name-history");
    generalGroup.addSetting((setting) => {
      setting.setName("History property name").setDesc("The list property to store file name history.").addText(
        (text) => text.setPlaceholder("aliases").setValue(this.plugin.settings.historyPropertyName).onChange((value) => {
          this.plugin.settings.historyPropertyName = value || "aliases";
          saveSettings();
        })
      );
    });
    generalGroup.addSetting((setting) => {
      setting.setName("Timeout seconds").setDesc("Time in seconds the name must be stable before adding to the configured property.").addSlider(
        (slider) => slider.setLimits(1, 20, 1).setValue(this.plugin.settings.timeoutSeconds).setDynamicTooltip().onChange((value) => {
          this.plugin.settings.timeoutSeconds = value;
          saveSettings();
        })
      );
    });
    generalGroup.addSetting((setting) => {
      setting.setName("Case-sensitive uniqueness").setDesc("If enabled, treat case differences as unique values in the configured property.").addToggle(
        (toggle) => toggle.setValue(this.plugin.settings.caseSensitive).onChange((value) => {
          this.plugin.settings.caseSensitive = value;
          saveSettings();
        })
      );
    });
    generalGroup.addSetting((setting) => {
      setting.setName("Auto-create history property").setDesc("Automatically create the configured property if missing.").addToggle(
        (toggle) => toggle.setValue(this.plugin.settings.autoCreateFrontmatter).onChange((value) => {
          this.plugin.settings.autoCreateFrontmatter = value;
          saveSettings();
        })
      );
    });
    generalGroup.addSetting((setting) => {
      setting.setName("File extensions").setDesc("Comma-separated list of file extensions to track.").addText(
        (text) => text.setPlaceholder("Md, txt").setValue(this.plugin.settings.fileExtensions.join(",")).onChange((value) => {
          this.plugin.settings.fileExtensions = value.split(",").map((s) => s.trim()).filter((s) => s);
          saveSettings();
        })
      );
    });
    const filteringGroup = createSettingsGroup(containerEl, "Filtering", "file-name-history");
    const foldersGroup = createSettingsGroup(containerEl, "Folders", "file-name-history");
    const advancedGroup = createSettingsGroup(containerEl, "Advanced", "file-name-history");
    filteringGroup.addSetting((setting) => {
      setting.setName("Ignore regex patterns").setDesc(
        "Comma-separated regex patterns for file names or immediate parent folder names to ignore (e.g., ^_ for underscore prefixes, ^untitled$ for untitled). Leave empty to disable."
      ).addText(
        (text) => text.setPlaceholder("^_, ^untitled$, ^untitled \\d+$").setValue(this.plugin.settings.ignoreRegexes.join(",")).onChange((value) => {
          this.plugin.settings.ignoreRegexes = value.split(",").map((s) => s.trim()).filter((s) => s);
          saveSettings();
        })
      );
    });
    filteringGroup.addSetting((setting) => {
      setting.setName("Exclude property name").setDesc(
        "Name of a boolean property to check in files. Files with this property set to true will be excluded from tracking. Takes priority over folder filtering."
      ).addText(
        (text) => text.setPlaceholder("Skip-rename-tracking").setValue(this.plugin.settings.excludePropertyName).onChange((value) => {
          this.plugin.settings.excludePropertyName = value;
          saveSettings();
        })
      );
    });
    foldersGroup.addSetting((setting) => {
      setting.setName("Include folders").setDesc(
        "Comma-separated list of folder paths to include. If empty, all folders are included. Use {vault} or {root} to include only files directly in the vault root (no subfolders)."
      ).addText(
        (text) => text.setValue(this.plugin.settings.includeFolders.join(",")).onChange((value) => {
          this.plugin.settings.includeFolders = value.split(",").map((s) => s.trim()).filter((s) => s);
          saveSettings();
        })
      );
    });
    foldersGroup.addSetting((setting) => {
      setting.setName("Exclude folders").setDesc(
        'Comma-separated list of folder paths to exclude. Supports wildcards: use "folder/*" to exclude direct children, "folder/**" to exclude all descendants. Use {vault} or {root} to exclude files directly in the vault root.'
      ).addText(
        (text) => text.setValue(this.plugin.settings.excludeFolders.join(",")).onChange((value) => {
          this.plugin.settings.excludeFolders = value.split(",").map((s) => s.trim()).filter((s) => s);
          saveSettings();
        })
      );
    });
    advancedGroup.addSetting((setting) => {
      setting.setName("Track folder renames for specific file name").setDesc(
        "If a Markdown file matches this file name, store old immediate parent folder names in the configured property when parent folders are renamed."
      ).addText(
        (text) => text.setPlaceholder("Index").setValue(this.plugin.settings.trackFolderRenames).onChange((value) => {
          this.plugin.settings.trackFolderRenames = value;
          saveSettings();
        })
      );
    });
  }
};

// src/utils/history-processor.ts
var import_obsidian3 = require("obsidian");
var HistoryProcessor = class {
  constructor(app, settings) {
    this.app = app;
    this.settings = settings;
  }
  async processAliasesManually(path, queue) {
    const file = this.app.vault.getFileByPath(path);
    if (!file) {
      return;
    }
    const regexes = [];
    for (const regexStr of this.settings.ignoreRegexes) {
      try {
        regexes.push(new RegExp(regexStr));
      } catch (e) {
        console.error(`Invalid ignore regex: ${regexStr}`, e);
      }
    }
    const toAdd = [];
    const currentBasename = file.basename;
    const currentBasenameLower = currentBasename.toLowerCase();
    for (const name of queue) {
      if (regexes.some((re) => re.test(name))) {
        continue;
      }
      const nameLower = name.toLowerCase();
      if (this.settings.caseSensitive && name === currentBasename || !this.settings.caseSensitive && nameLower === currentBasenameLower) {
        continue;
      }
      toAdd.push(name);
    }
    if (toAdd.length === 0) {
      return;
    }
    let content = await this.app.vault.read(file);
    const frontmatterRegex = /^---\n([\s\S]*?)\n---\n/;
    const match = content.match(frontmatterRegex);
    let frontmatter = {};
    let frontmatterText = "";
    let bodyContent = content;
    if (match) {
      frontmatterText = match[1];
      bodyContent = content.slice(match[0].length);
      try {
        const parsed = (0, import_obsidian3.parseYaml)(frontmatterText);
        frontmatter = parsed && typeof parsed === "object" ? parsed : {};
      } catch (e) {
        console.error(`Error parsing properties:`, e);
        frontmatter = {};
      }
    } else {
      bodyContent = content;
    }
    let aliases = frontmatter[this.settings.historyPropertyName];
    if (!Array.isArray(aliases)) {
      const hasFrontmatter = Object.keys(frontmatter).length > 0;
      if (hasFrontmatter && !this.settings.autoCreateFrontmatter) {
        return;
      }
      aliases = [];
    }
    const aliasesArray = aliases;
    const existing = new Set(
      this.settings.caseSensitive ? aliasesArray : aliasesArray.map((a) => a.toLowerCase())
    );
    let added = false;
    for (const name of toAdd) {
      const checkName = this.settings.caseSensitive ? name : name.toLowerCase();
      if (!existing.has(checkName)) {
        aliasesArray.push(name);
        existing.add(checkName);
        added = true;
      }
    }
    if (!added) {
      return;
    }
    frontmatter[this.settings.historyPropertyName] = aliasesArray;
    const newFrontmatterText = (0, import_obsidian3.stringifyYaml)(frontmatter).trim();
    const newContent = `---
${newFrontmatterText}
---
${bodyContent}`;
    await this.app.vault.modify(file, newContent);
  }
  async processAliases(path, queue) {
    const file = this.app.vault.getFileByPath(path);
    if (!file) return;
    const regexes = [];
    for (const regexStr of this.settings.ignoreRegexes) {
      try {
        regexes.push(new RegExp(regexStr));
      } catch (e) {
        console.error(`Invalid ignore regex: ${regexStr}`, e);
      }
    }
    const toAdd = [];
    const currentBasename = file.basename;
    const currentBasenameLower = currentBasename.toLowerCase();
    for (const name of queue) {
      if (regexes.some((re) => re.test(name))) {
        continue;
      }
      const nameLower = name.toLowerCase();
      if (this.settings.caseSensitive && name === currentBasename || !this.settings.caseSensitive && nameLower === currentBasenameLower) {
        continue;
      }
      toAdd.push(name);
    }
    if (toAdd.length === 0) {
      return;
    }
    if (file.extension !== "md") {
      await this.processAliasesManually(path, queue);
      return;
    }
    await this.app.fileManager.processFrontMatter(file, (fm) => {
      let aliases = fm[this.settings.historyPropertyName];
      if (!Array.isArray(aliases)) {
        const hasFrontmatter = Object.keys(fm).length > 0;
        if (hasFrontmatter && !this.settings.autoCreateFrontmatter) {
          return;
        }
        aliases = [];
        fm[this.settings.historyPropertyName] = aliases;
      }
      const aliasesArray = aliases;
      const existing = new Set(
        this.settings.caseSensitive ? aliasesArray : aliasesArray.map((a) => a.toLowerCase())
      );
      for (const name of toAdd) {
        const checkName = this.settings.caseSensitive ? name : name.toLowerCase();
        if (!existing.has(checkName)) {
          aliasesArray.push(name);
          existing.add(checkName);
        }
      }
    });
  }
};

// src/utils/path-utils.ts
function getBasename(path) {
  const name = path.split("/").pop() || "";
  return name.replace(/\.[^/.]+$/, "");
}
function getImmediateParentName(path) {
  const parts = path.split("/");
  parts.pop();
  return parts.pop() || "";
}

// src/main.ts
var FileNameHistoryPlugin = class extends import_obsidian4.Plugin {
  constructor() {
    super(...arguments);
    this.debounceMap = /* @__PURE__ */ new Map();
  }
  async onload() {
    await this.loadSettings();
    this.historyProcessor = new HistoryProcessor(this.app, this.settings);
    this.addSettingTab(new FileNameHistorySettingTab(this.app, this));
    this.registerEvent(
      this.app.vault.on("rename", (file, oldPath) => {
        this.handleRename(file, oldPath);
      })
    );
  }
  onunload() {
    for (const entry of this.debounceMap.values()) {
      if (entry.timeoutId !== 0) {
        window.clearTimeout(entry.timeoutId);
      }
    }
    this.debounceMap.clear();
  }
  async loadSettings() {
    const loadedData = await this.loadData();
    this.settings = Object.assign({}, DEFAULT_SETTINGS, loadedData);
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
  isPathInFolder(path, folder) {
    if (folder.includes("{vault}") || folder.includes("{root}")) {
      const resolvedFolder = folder.replace(/\{vault\}|\{root\}/g, "");
      if (resolvedFolder === "" || resolvedFolder === "/") {
        const isVaultRoot = !path.includes("/");
        return isVaultRoot;
      }
      return path.startsWith(resolvedFolder + "/") || path === resolvedFolder;
    }
    return path.startsWith(folder + "/") || path === folder;
  }
  isPathExcluded(path, excludePattern) {
    if (excludePattern.includes("{vault}") || excludePattern.includes("{root}")) {
      const resolvedPattern = excludePattern.replace(/\{vault\}|\{root\}/g, "");
      if (resolvedPattern === "" || resolvedPattern === "/") {
        return !path.includes("/");
      }
      excludePattern = resolvedPattern;
    }
    if (excludePattern.endsWith("/**")) {
      const baseFolder = excludePattern.slice(0, -3);
      return path.startsWith(baseFolder + "/") || path === baseFolder;
    } else if (excludePattern.endsWith("/*")) {
      const baseFolder = excludePattern.slice(0, -2);
      if (!path.startsWith(baseFolder + "/")) {
        return path === baseFolder;
      }
      const pathAfterBase = path.slice(baseFolder.length + 1);
      return pathAfterBase.includes("/");
    }
    return path.startsWith(excludePattern + "/") || path === excludePattern;
  }
  handleRename(newFile, oldPath) {
    if (!(newFile instanceof import_obsidian4.TFile)) return;
    if (!this.settings.fileExtensions.includes(newFile.extension)) return;
    const oldBasename = getBasename(oldPath);
    const newBasename = newFile.basename;
    const oldImmediateParentName = getImmediateParentName(oldPath);
    const newImmediateParentName = getImmediateParentName(newFile.path);
    const isNameChange = this.settings.caseSensitive ? oldBasename !== newBasename : oldBasename.toLowerCase() !== newBasename.toLowerCase();
    const isFolderChange = oldImmediateParentName !== newImmediateParentName && !isNameChange;
    if (!isNameChange && !isFolderChange) {
      return;
    }
    const path = newFile.path;
    if (this.settings.excludePropertyName && this.settings.excludePropertyName.trim() !== "") {
      const cache = this.app.metadataCache.getFileCache(newFile);
      const frontmatter = cache == null ? void 0 : cache.frontmatter;
      if (frontmatter && frontmatter[this.settings.excludePropertyName] === true) {
        return;
      }
    }
    if (this.settings.includeFolders.length > 0) {
      if (!this.settings.includeFolders.some((f) => this.isPathInFolder(path, f))) {
        return;
      }
    }
    const isIndexFileForFolderRename = isFolderChange && this.settings.trackFolderRenames && this.settings.trackFolderRenames.trim() !== "" && (this.settings.caseSensitive ? newFile.basename === this.settings.trackFolderRenames : newFile.basename.toLowerCase() === this.settings.trackFolderRenames.toLowerCase());
    for (const excludePattern of this.settings.excludeFolders) {
      if (this.isPathExcluded(path, excludePattern)) {
        if (isIndexFileForFolderRename && excludePattern.endsWith("/*") && !excludePattern.endsWith("/**")) {
          const baseFolder = excludePattern.slice(0, -2);
          if (path.startsWith(baseFolder + "/")) {
            const pathAfterBase = path.slice(baseFolder.length + 1);
            const pathParts = pathAfterBase.split("/");
            if (pathParts.length === 2) {
              continue;
            }
          }
        }
        return;
      }
    }
    const regexes = [];
    for (const regexStr of this.settings.ignoreRegexes) {
      try {
        regexes.push(new RegExp(regexStr));
      } catch (e) {
        console.error(`Invalid ignore regex: ${regexStr}`, e);
      }
    }
    let toQueue = null;
    if (isNameChange) {
      if (regexes.some((re) => re.test(oldBasename) || re.test(newBasename))) {
        return;
      }
      toQueue = oldBasename;
    } else if (isFolderChange && this.settings.trackFolderRenames && this.settings.trackFolderRenames.trim() !== "") {
      const currentBasename = newFile.basename;
      const matchesFilename = this.settings.caseSensitive ? currentBasename === this.settings.trackFolderRenames : currentBasename.toLowerCase() === this.settings.trackFolderRenames.toLowerCase();
      if (!matchesFilename) {
        return;
      }
      if (oldImmediateParentName === "" || newImmediateParentName === "") {
        return;
      }
      if (regexes.some((re) => re.test(oldImmediateParentName) || re.test(newImmediateParentName))) {
        return;
      }
      toQueue = oldImmediateParentName;
    }
    if (!toQueue) return;
    let existingEntry = this.debounceMap.get(newFile.path);
    if (!existingEntry) {
      existingEntry = this.debounceMap.get(oldPath);
      if (existingEntry) {
        this.debounceMap.delete(oldPath);
      }
    }
    if (existingEntry) {
      if (existingEntry.timeoutId !== 0) {
        window.clearTimeout(existingEntry.timeoutId);
      }
      toQueue = Array.from(existingEntry.queue)[0];
    }
    const entry = {
      queue: /* @__PURE__ */ new Set([toQueue]),
      timeoutId: 0,
      currentPath: newFile.path
    };
    entry.timeoutId = window.setTimeout(() => {
      void (async () => {
        try {
          await this.historyProcessor.processAliases(entry.currentPath, entry.queue);
        } catch (error) {
          console.error("Error processing aliases:", error);
        }
        this.debounceMap.delete(entry.currentPath);
      })();
    }, this.settings.timeoutSeconds * 1e3);
    this.debounceMap.set(newFile.path, entry);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiLCAic3JjL3NldHRpbmdzLnRzIiwgInNyYy91aS9zZXR0aW5ncy10YWIudHMiLCAic3JjL3V0aWxzL3NldHRpbmdzLWNvbXBhdC50cyIsICJzcmMvdXRpbHMvaGlzdG9yeS1wcm9jZXNzb3IudHMiLCAic3JjL3V0aWxzL3BhdGgtdXRpbHMudHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbImltcG9ydCB7IFBsdWdpbiwgVEFic3RyYWN0RmlsZSwgVEZpbGUgfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgeyBGaWxlTmFtZUhpc3RvcnlTZXR0aW5ncywgREVGQVVMVF9TRVRUSU5HUyB9IGZyb20gJy4vc2V0dGluZ3MnO1xuaW1wb3J0IHsgRmlsZU5hbWVIaXN0b3J5U2V0dGluZ1RhYiB9IGZyb20gJy4vdWkvc2V0dGluZ3MtdGFiJztcbmltcG9ydCB7IEhpc3RvcnlQcm9jZXNzb3IgfSBmcm9tICcuL3V0aWxzL2hpc3RvcnktcHJvY2Vzc29yJztcbmltcG9ydCB7IGdldEJhc2VuYW1lLCBnZXRJbW1lZGlhdGVQYXJlbnROYW1lIH0gZnJvbSAnLi91dGlscy9wYXRoLXV0aWxzJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRmlsZU5hbWVIaXN0b3J5UGx1Z2luIGV4dGVuZHMgUGx1Z2luIHtcbiAgc2V0dGluZ3M6IEZpbGVOYW1lSGlzdG9yeVNldHRpbmdzO1xuICBwcml2YXRlIGRlYm91bmNlTWFwOiBNYXA8c3RyaW5nLCB7IHF1ZXVlOiBTZXQ8c3RyaW5nPjsgdGltZW91dElkOiBudW1iZXI7IGN1cnJlbnRQYXRoOiBzdHJpbmcgfT4gPSBuZXcgTWFwKCk7XG4gIHByaXZhdGUgaGlzdG9yeVByb2Nlc3NvcjogSGlzdG9yeVByb2Nlc3NvcjtcblxuICBhc3luYyBvbmxvYWQoKSB7XG4gICAgYXdhaXQgdGhpcy5sb2FkU2V0dGluZ3MoKTtcbiAgICB0aGlzLmhpc3RvcnlQcm9jZXNzb3IgPSBuZXcgSGlzdG9yeVByb2Nlc3Nvcih0aGlzLmFwcCwgdGhpcy5zZXR0aW5ncyk7XG4gICAgdGhpcy5hZGRTZXR0aW5nVGFiKG5ldyBGaWxlTmFtZUhpc3RvcnlTZXR0aW5nVGFiKHRoaXMuYXBwLCB0aGlzKSk7XG4gICAgdGhpcy5yZWdpc3RlckV2ZW50KFxuICAgICAgdGhpcy5hcHAudmF1bHQub24oJ3JlbmFtZScsIChmaWxlOiBUQWJzdHJhY3RGaWxlLCBvbGRQYXRoOiBzdHJpbmcpID0+IHtcbiAgICAgICAgdGhpcy5oYW5kbGVSZW5hbWUoZmlsZSwgb2xkUGF0aCk7XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICBvbnVubG9hZCgpIHtcbiAgICAvLyBDbGVhciBhbnkgcGVuZGluZyB0aW1lb3V0c1xuICAgIGZvciAoY29uc3QgZW50cnkgb2YgdGhpcy5kZWJvdW5jZU1hcC52YWx1ZXMoKSkge1xuICAgICAgaWYgKGVudHJ5LnRpbWVvdXRJZCAhPT0gMCkge1xuICAgICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KGVudHJ5LnRpbWVvdXRJZCk7XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuZGVib3VuY2VNYXAuY2xlYXIoKTtcbiAgfVxuXG4gIGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcbiAgICBjb25zdCBsb2FkZWREYXRhID0gKGF3YWl0IHRoaXMubG9hZERhdGEoKSkgYXMgUGFydGlhbDxGaWxlTmFtZUhpc3RvcnlTZXR0aW5ncz4gfCBudWxsO1xuICAgIHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NFVFRJTkdTLCBsb2FkZWREYXRhKTtcbiAgfVxuXG4gIGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcbiAgICBhd2FpdCB0aGlzLnNhdmVEYXRhKHRoaXMuc2V0dGluZ3MpO1xuICB9XG5cbiAgcHJpdmF0ZSBpc1BhdGhJbkZvbGRlcihwYXRoOiBzdHJpbmcsIGZvbGRlcjogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgLy8gSGFuZGxlIHZhdWx0IHJvb3QgdmFyaWFibGVcbiAgICBpZiAoZm9sZGVyLmluY2x1ZGVzKCd7dmF1bHR9JykgfHwgZm9sZGVyLmluY2x1ZGVzKCd7cm9vdH0nKSkge1xuICAgICAgY29uc3QgcmVzb2x2ZWRGb2xkZXIgPSBmb2xkZXIucmVwbGFjZSgvXFx7dmF1bHRcXH18XFx7cm9vdFxcfS9nLCAnJyk7XG4gICAgICAvLyBJZiB0aGUgZm9sZGVyIGlzIGp1c3QgdGhlIHZhcmlhYmxlLCBpdCBtZWFucyBpbmNsdWRlIG9ubHkgdmF1bHQgcm9vdCBmaWxlc1xuICAgICAgaWYgKHJlc29sdmVkRm9sZGVyID09PSAnJyB8fCByZXNvbHZlZEZvbGRlciA9PT0gJy8nKSB7XG4gICAgICAgIC8vIEluY2x1ZGUgb25seSBmaWxlcyBkaXJlY3RseSBpbiB0aGUgdmF1bHQgcm9vdCAobm8gc3ViZm9sZGVycylcbiAgICAgICAgY29uc3QgaXNWYXVsdFJvb3QgPSAhcGF0aC5pbmNsdWRlcygnLycpO1xuICAgICAgICByZXR1cm4gaXNWYXVsdFJvb3Q7XG4gICAgICB9XG4gICAgICAvLyBPdGhlcndpc2UsIHJlcGxhY2UgdGhlIHZhcmlhYmxlIGFuZCBjaGVjayBub3JtYWxseVxuICAgICAgcmV0dXJuIHBhdGguc3RhcnRzV2l0aChyZXNvbHZlZEZvbGRlciArICcvJykgfHwgcGF0aCA9PT0gcmVzb2x2ZWRGb2xkZXI7XG4gICAgfVxuXG4gICAgLy8gTm9ybWFsIGZvbGRlciBtYXRjaGluZ1xuICAgIHJldHVybiBwYXRoLnN0YXJ0c1dpdGgoZm9sZGVyICsgJy8nKSB8fCBwYXRoID09PSBmb2xkZXI7XG4gIH1cblxuICBwcml2YXRlIGlzUGF0aEV4Y2x1ZGVkKHBhdGg6IHN0cmluZywgZXhjbHVkZVBhdHRlcm46IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIC8vIEhhbmRsZSB2YXVsdCByb290IHZhcmlhYmxlXG4gICAgaWYgKGV4Y2x1ZGVQYXR0ZXJuLmluY2x1ZGVzKCd7dmF1bHR9JykgfHwgZXhjbHVkZVBhdHRlcm4uaW5jbHVkZXMoJ3tyb290fScpKSB7XG4gICAgICBjb25zdCByZXNvbHZlZFBhdHRlcm4gPSBleGNsdWRlUGF0dGVybi5yZXBsYWNlKC9cXHt2YXVsdFxcfXxcXHtyb290XFx9L2csICcnKTtcbiAgICAgIGlmIChyZXNvbHZlZFBhdHRlcm4gPT09ICcnIHx8IHJlc29sdmVkUGF0dGVybiA9PT0gJy8nKSB7XG4gICAgICAgIC8vIEV4Y2x1ZGUgb25seSBmaWxlcyBkaXJlY3RseSBpbiB0aGUgdmF1bHQgcm9vdCAobm8gc3ViZm9sZGVycylcbiAgICAgICAgcmV0dXJuICFwYXRoLmluY2x1ZGVzKCcvJyk7XG4gICAgICB9XG4gICAgICBleGNsdWRlUGF0dGVybiA9IHJlc29sdmVkUGF0dGVybjtcbiAgICB9XG5cbiAgICAvLyBIYW5kbGUgd2lsZGNhcmRzXG4gICAgaWYgKGV4Y2x1ZGVQYXR0ZXJuLmVuZHNXaXRoKCcvKionKSkge1xuICAgICAgLy8gUmVjdXJzaXZlIGV4Y2x1c2lvbjogZG9jcy8qKiBtYXRjaGVzIGRvY3MgYW5kIGFsbCBzdWJmb2xkZXJzXG4gICAgICBjb25zdCBiYXNlRm9sZGVyID0gZXhjbHVkZVBhdHRlcm4uc2xpY2UoMCwgLTMpO1xuICAgICAgcmV0dXJuIHBhdGguc3RhcnRzV2l0aChiYXNlRm9sZGVyICsgJy8nKSB8fCBwYXRoID09PSBiYXNlRm9sZGVyO1xuICAgIH0gZWxzZSBpZiAoZXhjbHVkZVBhdHRlcm4uZW5kc1dpdGgoJy8qJykpIHtcbiAgICAgIC8vIERpcmVjdCBjaGlsZHJlbiBvbmx5OiBkb2NzLyogbWF0Y2hlcyBkb2NzL3N1YmZvbGRlciBidXQgbm90IGRvY3Mvc3ViZm9sZGVyL25lc3RlZFxuICAgICAgLy8gU2hvdWxkIGV4Y2x1ZGUgZmlsZXMgaW4gc3ViZm9sZGVycywgYnV0IE5PVCBmaWxlcyBkaXJlY3RseSBpbiB0aGUgYmFzZSBmb2xkZXJcbiAgICAgIGNvbnN0IGJhc2VGb2xkZXIgPSBleGNsdWRlUGF0dGVybi5zbGljZSgwLCAtMik7XG4gICAgICBpZiAoIXBhdGguc3RhcnRzV2l0aChiYXNlRm9sZGVyICsgJy8nKSkge1xuICAgICAgICByZXR1cm4gcGF0aCA9PT0gYmFzZUZvbGRlcjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHBhdGhBZnRlckJhc2UgPSBwYXRoLnNsaWNlKGJhc2VGb2xkZXIubGVuZ3RoICsgMSk7XG4gICAgICAvLyBFeGNsdWRlIGlmIHBhdGggaXMgaW4gYSBzdWJmb2xkZXIgKGhhcyBhdCBsZWFzdCBvbmUgc2xhc2gpXG4gICAgICAvLyBEb24ndCBleGNsdWRlIGZpbGVzIGRpcmVjdGx5IGluIHRoZSBiYXNlIGZvbGRlciAobm8gc2xhc2gpXG4gICAgICByZXR1cm4gcGF0aEFmdGVyQmFzZS5pbmNsdWRlcygnLycpO1xuICAgIH1cblxuICAgIC8vIE5vcm1hbCBmb2xkZXIgbWF0Y2hpbmdcbiAgICByZXR1cm4gcGF0aC5zdGFydHNXaXRoKGV4Y2x1ZGVQYXR0ZXJuICsgJy8nKSB8fCBwYXRoID09PSBleGNsdWRlUGF0dGVybjtcbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlUmVuYW1lKG5ld0ZpbGU6IFRBYnN0cmFjdEZpbGUsIG9sZFBhdGg6IHN0cmluZykge1xuICAgIGlmICghKG5ld0ZpbGUgaW5zdGFuY2VvZiBURmlsZSkpIHJldHVybjtcbiAgICBpZiAoIXRoaXMuc2V0dGluZ3MuZmlsZUV4dGVuc2lvbnMuaW5jbHVkZXMobmV3RmlsZS5leHRlbnNpb24pKSByZXR1cm47XG5cbiAgICBjb25zdCBvbGRCYXNlbmFtZSA9IGdldEJhc2VuYW1lKG9sZFBhdGgpO1xuICAgIGNvbnN0IG5ld0Jhc2VuYW1lID0gbmV3RmlsZS5iYXNlbmFtZTtcbiAgICBjb25zdCBvbGRJbW1lZGlhdGVQYXJlbnROYW1lID0gZ2V0SW1tZWRpYXRlUGFyZW50TmFtZShvbGRQYXRoKTtcbiAgICBjb25zdCBuZXdJbW1lZGlhdGVQYXJlbnROYW1lID0gZ2V0SW1tZWRpYXRlUGFyZW50TmFtZShuZXdGaWxlLnBhdGgpO1xuXG4gICAgY29uc3QgaXNOYW1lQ2hhbmdlID0gdGhpcy5zZXR0aW5ncy5jYXNlU2Vuc2l0aXZlXG4gICAgICA/IG9sZEJhc2VuYW1lICE9PSBuZXdCYXNlbmFtZVxuICAgICAgOiBvbGRCYXNlbmFtZS50b0xvd2VyQ2FzZSgpICE9PSBuZXdCYXNlbmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgIGNvbnN0IGlzRm9sZGVyQ2hhbmdlID0gb2xkSW1tZWRpYXRlUGFyZW50TmFtZSAhPT0gbmV3SW1tZWRpYXRlUGFyZW50TmFtZSAmJiAhaXNOYW1lQ2hhbmdlO1xuXG4gICAgaWYgKCFpc05hbWVDaGFuZ2UgJiYgIWlzRm9sZGVyQ2hhbmdlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgcGF0aCA9IG5ld0ZpbGUucGF0aDtcblxuICAgIC8vIEFwcGx5IGZpbHRlcmluZyBjaGVja3MgdG8gYm90aCBmaWxlIG5hbWUgY2hhbmdlcyBhbmQgZm9sZGVyIHJlbmFtZXNcbiAgICAvLyBQcmlvcml0eTogUHJvcGVydHkgZXhjbHVzaW9uIC0+IEluY2x1ZGUgZm9sZGVycyAtPiBFeGNsdWRlIGZvbGRlcnNcblxuICAgIC8vIDEuIENoZWNrIHByb3BlcnR5LWJhc2VkIGV4Y2x1c2lvbiBmaXJzdCAoaGlnaGVzdCBwcmlvcml0eSlcbiAgICBpZiAodGhpcy5zZXR0aW5ncy5leGNsdWRlUHJvcGVydHlOYW1lICYmIHRoaXMuc2V0dGluZ3MuZXhjbHVkZVByb3BlcnR5TmFtZS50cmltKCkgIT09ICcnKSB7XG4gICAgICBjb25zdCBjYWNoZSA9IHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0RmlsZUNhY2hlKG5ld0ZpbGUpO1xuICAgICAgY29uc3QgZnJvbnRtYXR0ZXIgPSBjYWNoZT8uZnJvbnRtYXR0ZXI7XG4gICAgICBpZiAoZnJvbnRtYXR0ZXIgJiYgZnJvbnRtYXR0ZXJbdGhpcy5zZXR0aW5ncy5leGNsdWRlUHJvcGVydHlOYW1lXSA9PT0gdHJ1ZSkge1xuICAgICAgICByZXR1cm47IC8vIEV4Y2x1ZGUgdGhpcyBmaWxlXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gMi4gQ2hlY2sgaW5jbHVkZSBmb2xkZXJzIChpZiBpbmNsdWRlRm9sZGVycyBpcyBub3QgZW1wdHksIG9ubHkgaW5jbHVkZSB0aG9zZSlcbiAgICBpZiAodGhpcy5zZXR0aW5ncy5pbmNsdWRlRm9sZGVycy5sZW5ndGggPiAwKSB7XG4gICAgICBpZiAoIXRoaXMuc2V0dGluZ3MuaW5jbHVkZUZvbGRlcnMuc29tZShmID0+IHRoaXMuaXNQYXRoSW5Gb2xkZXIocGF0aCwgZikpKSB7XG4gICAgICAgIHJldHVybjsgLy8gTm90IGluIGFueSBpbmNsdWRlZCBmb2xkZXJcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyAzLiBDaGVjayBleGNsdWRlIGZvbGRlcnMgKHdpdGggd2lsZGNhcmQgc3VwcG9ydClcbiAgICAvLyBTcGVjaWFsIGNhc2U6IGlmIHRyYWNraW5nIGZvbGRlciByZW5hbWVzIGZvciBhIHNwZWNpZmljIGZpbGUgbmFtZSwgYWxsb3cgaXQgZXZlbiBpbiBleGNsdWRlZCBzdWJmb2xkZXJzXG4gICAgLy8gdW5sZXNzIHVzaW5nIHJlY3Vyc2l2ZSBleGNsdXNpb24gKCoqKSBvciB0aGUgZmlsZSBpcyBuZXN0ZWQgZGVlcGVyIHRoYW4gb25lIGxldmVsXG4gICAgY29uc3QgaXNJbmRleEZpbGVGb3JGb2xkZXJSZW5hbWUgPSBpc0ZvbGRlckNoYW5nZSAmJlxuICAgICAgdGhpcy5zZXR0aW5ncy50cmFja0ZvbGRlclJlbmFtZXMgJiZcbiAgICAgIHRoaXMuc2V0dGluZ3MudHJhY2tGb2xkZXJSZW5hbWVzLnRyaW0oKSAhPT0gJycgJiZcbiAgICAgICh0aGlzLnNldHRpbmdzLmNhc2VTZW5zaXRpdmVcbiAgICAgICAgPyBuZXdGaWxlLmJhc2VuYW1lID09PSB0aGlzLnNldHRpbmdzLnRyYWNrRm9sZGVyUmVuYW1lc1xuICAgICAgICA6IG5ld0ZpbGUuYmFzZW5hbWUudG9Mb3dlckNhc2UoKSA9PT0gdGhpcy5zZXR0aW5ncy50cmFja0ZvbGRlclJlbmFtZXMudG9Mb3dlckNhc2UoKSk7XG5cbiAgICBmb3IgKGNvbnN0IGV4Y2x1ZGVQYXR0ZXJuIG9mIHRoaXMuc2V0dGluZ3MuZXhjbHVkZUZvbGRlcnMpIHtcbiAgICAgIGlmICh0aGlzLmlzUGF0aEV4Y2x1ZGVkKHBhdGgsIGV4Y2x1ZGVQYXR0ZXJuKSkge1xuICAgICAgICAvLyBJZiB0aGlzIGlzIGFuIGluZGV4IGZpbGUgZm9yIGZvbGRlciByZW5hbWUgdHJhY2tpbmcsIGFuZCB0aGUgcGF0dGVybiBpcyAvKiAobm90IC8qKiksXG4gICAgICAgIC8vIGFsbG93IGl0IHRocm91Z2ggb25seSBpZiBpdCdzIGluIGEgZGlyZWN0IGNoaWxkIGZvbGRlciAob25lIGxldmVsIGRlZXApXG4gICAgICAgIGlmIChpc0luZGV4RmlsZUZvckZvbGRlclJlbmFtZSAmJiBleGNsdWRlUGF0dGVybi5lbmRzV2l0aCgnLyonKSAmJiAhZXhjbHVkZVBhdHRlcm4uZW5kc1dpdGgoJy8qKicpKSB7XG4gICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGZpbGUgaXMgaW4gYSBkaXJlY3QgY2hpbGQgKG9ubHkgb25lIGxldmVsIGRlZXApXG4gICAgICAgICAgY29uc3QgYmFzZUZvbGRlciA9IGV4Y2x1ZGVQYXR0ZXJuLnNsaWNlKDAsIC0yKTtcbiAgICAgICAgICBpZiAocGF0aC5zdGFydHNXaXRoKGJhc2VGb2xkZXIgKyAnLycpKSB7XG4gICAgICAgICAgICBjb25zdCBwYXRoQWZ0ZXJCYXNlID0gcGF0aC5zbGljZShiYXNlRm9sZGVyLmxlbmd0aCArIDEpO1xuICAgICAgICAgICAgY29uc3QgcGF0aFBhcnRzID0gcGF0aEFmdGVyQmFzZS5zcGxpdCgnLycpO1xuICAgICAgICAgICAgLy8gSWYgdGhlcmUncyBvbmx5IG9uZSBwYXRoIHBhcnQgYmVmb3JlIHRoZSBmaWxlbmFtZSwgaXQncyBhIGRpcmVjdCBjaGlsZFxuICAgICAgICAgICAgLy8gcGF0aFBhcnRzIHdpbGwgYmUgbGlrZSBbJ3N1YmZvbGRlcicsICdmaWxlbmFtZS5tZCddIC0gd2Ugd2FudCBleGFjdGx5IDIgcGFydHNcbiAgICAgICAgICAgIGlmIChwYXRoUGFydHMubGVuZ3RoID09PSAyKSB7XG4gICAgICAgICAgICAgIGNvbnRpbnVlOyAvLyBTa2lwIHRoaXMgZXhjbHVzaW9uIC0gaXQncyBhIGRpcmVjdCBjaGlsZCBpbmRleCBmaWxlXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybjsgLy8gRXhjbHVkZWQgYnkgZm9sZGVyIHBhdHRlcm5cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDaGVjayBpZ25vcmUgcmVnZXhlc1xuICAgIGNvbnN0IHJlZ2V4ZXM6IFJlZ0V4cFtdID0gW107XG4gICAgZm9yIChjb25zdCByZWdleFN0ciBvZiB0aGlzLnNldHRpbmdzLmlnbm9yZVJlZ2V4ZXMpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHJlZ2V4ZXMucHVzaChuZXcgUmVnRXhwKHJlZ2V4U3RyKSk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYEludmFsaWQgaWdub3JlIHJlZ2V4OiAke3JlZ2V4U3RyfWAsIGUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGxldCB0b1F1ZXVlOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcbiAgICBpZiAoaXNOYW1lQ2hhbmdlKSB7XG4gICAgICBpZiAocmVnZXhlcy5zb21lKHJlID0+IHJlLnRlc3Qob2xkQmFzZW5hbWUpIHx8IHJlLnRlc3QobmV3QmFzZW5hbWUpKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0b1F1ZXVlID0gb2xkQmFzZW5hbWU7XG4gICAgfSBlbHNlIGlmIChpc0ZvbGRlckNoYW5nZSAmJiB0aGlzLnNldHRpbmdzLnRyYWNrRm9sZGVyUmVuYW1lcyAmJiB0aGlzLnNldHRpbmdzLnRyYWNrRm9sZGVyUmVuYW1lcy50cmltKCkgIT09ICcnKSB7XG4gICAgICAvLyBDaGVjayBpZiB0aGUgY3VycmVudCBmaWxlIG5hbWUgbWF0Y2hlcyB0aGUgc3BlY2lmaWVkIG5hbWUgKHdpdGhvdXQgZXh0ZW5zaW9uKVxuICAgICAgY29uc3QgY3VycmVudEJhc2VuYW1lID0gbmV3RmlsZS5iYXNlbmFtZTtcbiAgICAgIGNvbnN0IG1hdGNoZXNGaWxlbmFtZSA9IHRoaXMuc2V0dGluZ3MuY2FzZVNlbnNpdGl2ZVxuICAgICAgICA/IGN1cnJlbnRCYXNlbmFtZSA9PT0gdGhpcy5zZXR0aW5ncy50cmFja0ZvbGRlclJlbmFtZXNcbiAgICAgICAgOiBjdXJyZW50QmFzZW5hbWUudG9Mb3dlckNhc2UoKSA9PT0gdGhpcy5zZXR0aW5ncy50cmFja0ZvbGRlclJlbmFtZXMudG9Mb3dlckNhc2UoKTtcblxuICAgICAgaWYgKCFtYXRjaGVzRmlsZW5hbWUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAob2xkSW1tZWRpYXRlUGFyZW50TmFtZSA9PT0gJycgfHwgbmV3SW1tZWRpYXRlUGFyZW50TmFtZSA9PT0gJycpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKHJlZ2V4ZXMuc29tZShyZSA9PiByZS50ZXN0KG9sZEltbWVkaWF0ZVBhcmVudE5hbWUpIHx8IHJlLnRlc3QobmV3SW1tZWRpYXRlUGFyZW50TmFtZSkpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRvUXVldWUgPSBvbGRJbW1lZGlhdGVQYXJlbnROYW1lO1xuICAgIH1cblxuICAgIGlmICghdG9RdWV1ZSkgcmV0dXJuO1xuXG4gICAgLy8gQ2hlY2sgaWYgdGhlcmUncyBhbHJlYWR5IGEgcGVuZGluZyB0aW1lb3V0IGZvciB0aGlzIGZpbGVcbiAgICAvLyBXZSBuZWVkIHRvIGNoZWNrIGJvdGggdGhlIG5ldyBwYXRoIGFuZCB0aGUgb2xkIHBhdGggc2luY2UgdGhlIGZpbGUgd2FzIGp1c3QgcmVuYW1lZFxuICAgIGxldCBleGlzdGluZ0VudHJ5ID0gdGhpcy5kZWJvdW5jZU1hcC5nZXQobmV3RmlsZS5wYXRoKTtcbiAgICBpZiAoIWV4aXN0aW5nRW50cnkpIHtcbiAgICAgIC8vIENoZWNrIGlmIHRoZXJlJ3MgYSB0aW1lb3V0IGZvciB0aGUgb2xkIHBhdGggKHRoZSBmaWxlIHdhcyBqdXN0IHJlbmFtZWQgZnJvbSB0aGVyZSlcbiAgICAgIGV4aXN0aW5nRW50cnkgPSB0aGlzLmRlYm91bmNlTWFwLmdldChvbGRQYXRoKTtcbiAgICAgIGlmIChleGlzdGluZ0VudHJ5KSB7XG4gICAgICAgIC8vIFJlbW92ZSB0aGUgb2xkIGVudHJ5IHNpbmNlIHdlJ3JlIHVwZGF0aW5nIGl0IHdpdGggdGhlIG5ldyBwYXRoXG4gICAgICAgIHRoaXMuZGVib3VuY2VNYXAuZGVsZXRlKG9sZFBhdGgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChleGlzdGluZ0VudHJ5KSB7XG4gICAgICAvLyBGaWxlIHdhcyByZW5hbWVkIGFnYWluIGJlZm9yZSB0aW1lb3V0IGV4cGlyZWQgLSBjYW5jZWwgdGhlIHByZXZpb3VzIHRpbWVvdXRcbiAgICAgIGlmIChleGlzdGluZ0VudHJ5LnRpbWVvdXRJZCAhPT0gMCkge1xuICAgICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KGV4aXN0aW5nRW50cnkudGltZW91dElkKTtcbiAgICAgIH1cblxuICAgICAgLy8gVXNlIHRoZSBvcmlnaW5hbCBzdGFibGUgbmFtZSBmcm9tIHRoZSBwcmV2aW91cyB0aW1lb3V0LCBub3QgdGhlIHRlbXBvcmFyeSBuYW1lXG4gICAgICB0b1F1ZXVlID0gQXJyYXkuZnJvbShleGlzdGluZ0VudHJ5LnF1ZXVlKVswXTsgLy8gVXNlIHRoZSBvcmlnaW5hbCBzdGFibGUgbmFtZVxuICAgIH1cblxuICAgIC8vIENyZWF0ZSBlbnRyeSB0byB0cmFjayB0aGUgdGltZW91dFxuICAgIGNvbnN0IGVudHJ5ID0ge1xuICAgICAgcXVldWU6IG5ldyBTZXQ8c3RyaW5nPihbdG9RdWV1ZV0pLFxuICAgICAgdGltZW91dElkOiAwLFxuICAgICAgY3VycmVudFBhdGg6IG5ld0ZpbGUucGF0aFxuICAgIH07XG5cbiAgICAvLyBTZXQgdGltZW91dCB0byBhY3R1YWxseSBzdG9yZSB0aGUgYWxpYXMgYWZ0ZXIgdGhlIGRlYm91bmNlIHBlcmlvZFxuICAgIGVudHJ5LnRpbWVvdXRJZCA9IHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHZvaWQgKGFzeW5jICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBhd2FpdCB0aGlzLmhpc3RvcnlQcm9jZXNzb3IucHJvY2Vzc0FsaWFzZXMoZW50cnkuY3VycmVudFBhdGgsIGVudHJ5LnF1ZXVlKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwcm9jZXNzaW5nIGFsaWFzZXM6JywgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZGVib3VuY2VNYXAuZGVsZXRlKGVudHJ5LmN1cnJlbnRQYXRoKTtcbiAgICAgIH0pKCk7XG4gICAgfSwgdGhpcy5zZXR0aW5ncy50aW1lb3V0U2Vjb25kcyAqIDEwMDApO1xuXG4gICAgdGhpcy5kZWJvdW5jZU1hcC5zZXQobmV3RmlsZS5wYXRoLCBlbnRyeSk7XG4gIH1cbn1cbiIsICJleHBvcnQgaW50ZXJmYWNlIEZpbGVOYW1lSGlzdG9yeVNldHRpbmdzIHtcclxuICBoaXN0b3J5UHJvcGVydHlOYW1lOiBzdHJpbmc7XHJcbiAgaWdub3JlUmVnZXhlczogc3RyaW5nW107XHJcbiAgdGltZW91dFNlY29uZHM6IG51bWJlcjtcclxuICBjYXNlU2Vuc2l0aXZlOiBib29sZWFuO1xyXG4gIGF1dG9DcmVhdGVGcm9udG1hdHRlcjogYm9vbGVhbjtcclxuICBpbmNsdWRlRm9sZGVyczogc3RyaW5nW107XHJcbiAgZXhjbHVkZUZvbGRlcnM6IHN0cmluZ1tdO1xyXG4gIGZpbGVFeHRlbnNpb25zOiBzdHJpbmdbXTtcclxuICB0cmFja0ZvbGRlclJlbmFtZXM6IHN0cmluZztcclxuICBleGNsdWRlUHJvcGVydHlOYW1lOiBzdHJpbmc7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBERUZBVUxUX1NFVFRJTkdTOiBGaWxlTmFtZUhpc3RvcnlTZXR0aW5ncyA9IHtcclxuICBoaXN0b3J5UHJvcGVydHlOYW1lOiAnYWxpYXNlcycsXHJcbiAgaWdub3JlUmVnZXhlczogWydeXycsICdeVW50aXRsZWQkJywgJ15VbnRpdGxlZCBcXFxcZCskJ10sXHJcbiAgdGltZW91dFNlY29uZHM6IDUsXHJcbiAgY2FzZVNlbnNpdGl2ZTogZmFsc2UsXHJcbiAgYXV0b0NyZWF0ZUZyb250bWF0dGVyOiB0cnVlLFxyXG4gIGluY2x1ZGVGb2xkZXJzOiBbXSxcclxuICBleGNsdWRlRm9sZGVyczogW10sXHJcbiAgZmlsZUV4dGVuc2lvbnM6IFsnbWQnXSxcclxuICB0cmFja0ZvbGRlclJlbmFtZXM6ICcnLFxyXG4gIGV4Y2x1ZGVQcm9wZXJ0eU5hbWU6ICcnLFxyXG59OyIsICJpbXBvcnQgeyBBcHAsIFBsdWdpbiwgUGx1Z2luU2V0dGluZ1RhYiB9IGZyb20gJ29ic2lkaWFuJztcclxuaW1wb3J0IHsgRmlsZU5hbWVIaXN0b3J5U2V0dGluZ3MgfSBmcm9tICcuLi9zZXR0aW5ncyc7XHJcbmltcG9ydCB7IGNyZWF0ZVNldHRpbmdzR3JvdXAgfSBmcm9tICcuLi91dGlscy9zZXR0aW5ncy1jb21wYXQnO1xyXG5cclxuaW50ZXJmYWNlIEZpbGVOYW1lSGlzdG9yeVBsdWdpbiBleHRlbmRzIFBsdWdpbiB7XHJcbiAgc2V0dGluZ3M6IEZpbGVOYW1lSGlzdG9yeVNldHRpbmdzO1xyXG4gIHNhdmVTZXR0aW5ncygpOiBQcm9taXNlPHZvaWQ+O1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgRmlsZU5hbWVIaXN0b3J5U2V0dGluZ1RhYiBleHRlbmRzIFBsdWdpblNldHRpbmdUYWIge1xyXG4gIHBsdWdpbjogRmlsZU5hbWVIaXN0b3J5UGx1Z2luO1xyXG4gIHB1YmxpYyBpY29uID0gJ2x1Y2lkZS1mb3J3YXJkJztcclxuXHJcbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogRmlsZU5hbWVIaXN0b3J5UGx1Z2luKSB7XHJcbiAgICBzdXBlcihhcHAsIHBsdWdpbik7XHJcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcclxuICB9XHJcblxyXG4gIGRpc3BsYXkoKTogdm9pZCB7XHJcbiAgICBjb25zdCB7IGNvbnRhaW5lckVsIH0gPSB0aGlzO1xyXG4gICAgY29udGFpbmVyRWwuZW1wdHkoKTtcclxuXHJcbiAgICAvLyBIZWxwZXIgdG8gc2F2ZSBzZXR0aW5ncyB3aXRob3V0IHJldHVybmluZyBhIHByb21pc2VcclxuICAgIGNvbnN0IHNhdmVTZXR0aW5ncyA9ICgpOiB2b2lkID0+IHtcclxuICAgICAgdm9pZCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgZ2VuZXJhbEdyb3VwID0gY3JlYXRlU2V0dGluZ3NHcm91cChjb250YWluZXJFbCwgdW5kZWZpbmVkLCAnZmlsZS1uYW1lLWhpc3RvcnknKTtcclxuXHJcbiAgICAvLyBHZW5lcmFsIGJlaGF2aW9yIHNldHRpbmdzIChncm91cGVkLCBubyBoZWFkaW5nKVxyXG4gICAgZ2VuZXJhbEdyb3VwLmFkZFNldHRpbmcoKHNldHRpbmcpID0+IHtcclxuICAgICAgc2V0dGluZ1xyXG4gICAgICAgIC5zZXROYW1lKCdIaXN0b3J5IHByb3BlcnR5IG5hbWUnKVxyXG4gICAgICAgIC5zZXREZXNjKCdUaGUgbGlzdCBwcm9wZXJ0eSB0byBzdG9yZSBmaWxlIG5hbWUgaGlzdG9yeS4nKVxyXG4gICAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PlxyXG4gICAgICAgICAgdGV4dFxyXG4gICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ2FsaWFzZXMnKVxyXG4gICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuaGlzdG9yeVByb3BlcnR5TmFtZSlcclxuICAgICAgICAgICAgLm9uQ2hhbmdlKCh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmhpc3RvcnlQcm9wZXJ0eU5hbWUgPSB2YWx1ZSB8fCAnYWxpYXNlcyc7XHJcbiAgICAgICAgICAgICAgc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGdlbmVyYWxHcm91cC5hZGRTZXR0aW5nKChzZXR0aW5nKSA9PiB7XHJcbiAgICAgIHNldHRpbmdcclxuICAgICAgICAuc2V0TmFtZSgnVGltZW91dCBzZWNvbmRzJylcclxuICAgICAgICAuc2V0RGVzYygnVGltZSBpbiBzZWNvbmRzIHRoZSBuYW1lIG11c3QgYmUgc3RhYmxlIGJlZm9yZSBhZGRpbmcgdG8gdGhlIGNvbmZpZ3VyZWQgcHJvcGVydHkuJylcclxuICAgICAgICAuYWRkU2xpZGVyKChzbGlkZXIpID0+XHJcbiAgICAgICAgICBzbGlkZXJcclxuICAgICAgICAgICAgLnNldExpbWl0cygxLCAyMCwgMSlcclxuICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnRpbWVvdXRTZWNvbmRzKVxyXG4gICAgICAgICAgICAuc2V0RHluYW1pY1Rvb2x0aXAoKVxyXG4gICAgICAgICAgICAub25DaGFuZ2UoKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MudGltZW91dFNlY29uZHMgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICBzYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZ2VuZXJhbEdyb3VwLmFkZFNldHRpbmcoKHNldHRpbmcpID0+IHtcclxuICAgICAgc2V0dGluZ1xyXG4gICAgICAgIC5zZXROYW1lKCdDYXNlLXNlbnNpdGl2ZSB1bmlxdWVuZXNzJylcclxuXHJcbiAgICAgICAgLnNldERlc2MoJ0lmIGVuYWJsZWQsIHRyZWF0IGNhc2UgZGlmZmVyZW5jZXMgYXMgdW5pcXVlIHZhbHVlcyBpbiB0aGUgY29uZmlndXJlZCBwcm9wZXJ0eS4nKVxyXG4gICAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT5cclxuICAgICAgICAgIHRvZ2dsZVxyXG4gICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuY2FzZVNlbnNpdGl2ZSlcclxuICAgICAgICAgICAgLm9uQ2hhbmdlKCh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmNhc2VTZW5zaXRpdmUgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICBzYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZ2VuZXJhbEdyb3VwLmFkZFNldHRpbmcoKHNldHRpbmcpID0+IHtcclxuICAgICAgc2V0dGluZ1xyXG4gICAgICAgIC5zZXROYW1lKCdBdXRvLWNyZWF0ZSBoaXN0b3J5IHByb3BlcnR5JylcclxuICAgICAgICAuc2V0RGVzYygnQXV0b21hdGljYWxseSBjcmVhdGUgdGhlIGNvbmZpZ3VyZWQgcHJvcGVydHkgaWYgbWlzc2luZy4nKVxyXG4gICAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT5cclxuICAgICAgICAgIHRvZ2dsZVxyXG4gICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuYXV0b0NyZWF0ZUZyb250bWF0dGVyKVxyXG4gICAgICAgICAgICAub25DaGFuZ2UoKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuYXV0b0NyZWF0ZUZyb250bWF0dGVyID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGdlbmVyYWxHcm91cC5hZGRTZXR0aW5nKChzZXR0aW5nKSA9PiB7XHJcbiAgICAgIHNldHRpbmdcclxuICAgICAgICAuc2V0TmFtZSgnRmlsZSBleHRlbnNpb25zJylcclxuICAgICAgICAuc2V0RGVzYygnQ29tbWEtc2VwYXJhdGVkIGxpc3Qgb2YgZmlsZSBleHRlbnNpb25zIHRvIHRyYWNrLicpXHJcbiAgICAgICAgLmFkZFRleHQoKHRleHQpID0+XHJcbiAgICAgICAgICB0ZXh0XHJcblxyXG4gICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ01kLCB0eHQnKVxyXG4gICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuZmlsZUV4dGVuc2lvbnMuam9pbignLCcpKVxyXG4gICAgICAgICAgICAub25DaGFuZ2UoKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZmlsZUV4dGVuc2lvbnMgPSB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgLnNwbGl0KCcsJylcclxuICAgICAgICAgICAgICAgIC5tYXAoKHMpID0+IHMudHJpbSgpKVxyXG4gICAgICAgICAgICAgICAgLmZpbHRlcigocykgPT4gcyk7XHJcbiAgICAgICAgICAgICAgc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IGZpbHRlcmluZ0dyb3VwID0gY3JlYXRlU2V0dGluZ3NHcm91cChjb250YWluZXJFbCwgJ0ZpbHRlcmluZycsICdmaWxlLW5hbWUtaGlzdG9yeScpO1xyXG4gICAgY29uc3QgZm9sZGVyc0dyb3VwID0gY3JlYXRlU2V0dGluZ3NHcm91cChjb250YWluZXJFbCwgJ0ZvbGRlcnMnLCAnZmlsZS1uYW1lLWhpc3RvcnknKTtcclxuICAgIGNvbnN0IGFkdmFuY2VkR3JvdXAgPSBjcmVhdGVTZXR0aW5nc0dyb3VwKGNvbnRhaW5lckVsLCAnQWR2YW5jZWQnLCAnZmlsZS1uYW1lLWhpc3RvcnknKTtcclxuXHJcbiAgICAvLyBGaWx0ZXJpbmcgc2V0dGluZ3NcclxuICAgIGZpbHRlcmluZ0dyb3VwLmFkZFNldHRpbmcoKHNldHRpbmcpID0+IHtcclxuICAgICAgc2V0dGluZ1xyXG4gICAgICAgIC5zZXROYW1lKCdJZ25vcmUgcmVnZXggcGF0dGVybnMnKVxyXG4gICAgICAgIC5zZXREZXNjKFxyXG4gICAgICAgICAgJ0NvbW1hLXNlcGFyYXRlZCByZWdleCBwYXR0ZXJucyBmb3IgZmlsZSBuYW1lcyBvciBpbW1lZGlhdGUgcGFyZW50IGZvbGRlciBuYW1lcyB0byBpZ25vcmUgKGUuZy4sIF5fIGZvciB1bmRlcnNjb3JlIHByZWZpeGVzLCBedW50aXRsZWQkIGZvciB1bnRpdGxlZCkuIExlYXZlIGVtcHR5IHRvIGRpc2FibGUuJ1xyXG4gICAgICAgIClcclxuICAgICAgICAuYWRkVGV4dCgodGV4dCkgPT5cclxuICAgICAgICAgIHRleHRcclxuICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKCdeXywgXnVudGl0bGVkJCwgXnVudGl0bGVkIFxcXFxkKyQnKVxyXG4gICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuaWdub3JlUmVnZXhlcy5qb2luKCcsJykpXHJcbiAgICAgICAgICAgIC5vbkNoYW5nZSgodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5pZ25vcmVSZWdleGVzID0gdmFsdWVcclxuICAgICAgICAgICAgICAgIC5zcGxpdCgnLCcpXHJcbiAgICAgICAgICAgICAgICAubWFwKChzKSA9PiBzLnRyaW0oKSlcclxuICAgICAgICAgICAgICAgIC5maWx0ZXIoKHMpID0+IHMpO1xyXG4gICAgICAgICAgICAgIHNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBmaWx0ZXJpbmdHcm91cC5hZGRTZXR0aW5nKChzZXR0aW5nKSA9PiB7XHJcbiAgICAgIHNldHRpbmdcclxuICAgICAgICAuc2V0TmFtZSgnRXhjbHVkZSBwcm9wZXJ0eSBuYW1lJylcclxuICAgICAgICAuc2V0RGVzYyhcclxuICAgICAgICAgICdOYW1lIG9mIGEgYm9vbGVhbiBwcm9wZXJ0eSB0byBjaGVjayBpbiBmaWxlcy4gRmlsZXMgd2l0aCB0aGlzIHByb3BlcnR5IHNldCB0byB0cnVlIHdpbGwgYmUgZXhjbHVkZWQgZnJvbSB0cmFja2luZy4gVGFrZXMgcHJpb3JpdHkgb3ZlciBmb2xkZXIgZmlsdGVyaW5nLidcclxuICAgICAgICApXHJcbiAgICAgICAgLmFkZFRleHQoKHRleHQpID0+XHJcbiAgICAgICAgICB0ZXh0XHJcblxyXG4gICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ1NraXAtcmVuYW1lLXRyYWNraW5nJylcclxuICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmV4Y2x1ZGVQcm9wZXJ0eU5hbWUpXHJcbiAgICAgICAgICAgIC5vbkNoYW5nZSgodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5leGNsdWRlUHJvcGVydHlOYW1lID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIEZvbGRlciBpbmNsdWRlL2V4Y2x1ZGUgc2V0dGluZ3NcclxuICAgIGZvbGRlcnNHcm91cC5hZGRTZXR0aW5nKChzZXR0aW5nKSA9PiB7XHJcbiAgICAgIHNldHRpbmdcclxuICAgICAgICAuc2V0TmFtZSgnSW5jbHVkZSBmb2xkZXJzJylcclxuICAgICAgICAuc2V0RGVzYyhcclxuICAgICAgICAgICdDb21tYS1zZXBhcmF0ZWQgbGlzdCBvZiBmb2xkZXIgcGF0aHMgdG8gaW5jbHVkZS4gSWYgZW1wdHksIGFsbCBmb2xkZXJzIGFyZSBpbmNsdWRlZC4gVXNlIHt2YXVsdH0gb3Ige3Jvb3R9IHRvIGluY2x1ZGUgb25seSBmaWxlcyBkaXJlY3RseSBpbiB0aGUgdmF1bHQgcm9vdCAobm8gc3ViZm9sZGVycykuJ1xyXG4gICAgICAgIClcclxuICAgICAgICAuYWRkVGV4dCgodGV4dCkgPT5cclxuICAgICAgICAgIHRleHRcclxuICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmluY2x1ZGVGb2xkZXJzLmpvaW4oJywnKSlcclxuICAgICAgICAgICAgLm9uQ2hhbmdlKCh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmluY2x1ZGVGb2xkZXJzID0gdmFsdWVcclxuICAgICAgICAgICAgICAgIC5zcGxpdCgnLCcpXHJcbiAgICAgICAgICAgICAgICAubWFwKChzKSA9PiBzLnRyaW0oKSlcclxuICAgICAgICAgICAgICAgIC5maWx0ZXIoKHMpID0+IHMpO1xyXG4gICAgICAgICAgICAgIHNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBmb2xkZXJzR3JvdXAuYWRkU2V0dGluZygoc2V0dGluZykgPT4ge1xyXG4gICAgICBzZXR0aW5nXHJcbiAgICAgICAgLnNldE5hbWUoJ0V4Y2x1ZGUgZm9sZGVycycpXHJcbiAgICAgICAgLnNldERlc2MoXHJcbiAgICAgICAgICAnQ29tbWEtc2VwYXJhdGVkIGxpc3Qgb2YgZm9sZGVyIHBhdGhzIHRvIGV4Y2x1ZGUuIFN1cHBvcnRzIHdpbGRjYXJkczogdXNlIFwiZm9sZGVyLypcIiB0byBleGNsdWRlIGRpcmVjdCBjaGlsZHJlbiwgXCJmb2xkZXIvKipcIiB0byBleGNsdWRlIGFsbCBkZXNjZW5kYW50cy4gVXNlIHt2YXVsdH0gb3Ige3Jvb3R9IHRvIGV4Y2x1ZGUgZmlsZXMgZGlyZWN0bHkgaW4gdGhlIHZhdWx0IHJvb3QuJ1xyXG4gICAgICAgIClcclxuICAgICAgICAuYWRkVGV4dCgodGV4dCkgPT5cclxuICAgICAgICAgIHRleHRcclxuICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmV4Y2x1ZGVGb2xkZXJzLmpvaW4oJywnKSlcclxuICAgICAgICAgICAgLm9uQ2hhbmdlKCh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmV4Y2x1ZGVGb2xkZXJzID0gdmFsdWVcclxuICAgICAgICAgICAgICAgIC5zcGxpdCgnLCcpXHJcbiAgICAgICAgICAgICAgICAubWFwKChzKSA9PiBzLnRyaW0oKSlcclxuICAgICAgICAgICAgICAgIC5maWx0ZXIoKHMpID0+IHMpO1xyXG4gICAgICAgICAgICAgIHNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBBZHZhbmNlZCAvIG5pY2hlIG9wdGlvbnNcclxuICAgIGFkdmFuY2VkR3JvdXAuYWRkU2V0dGluZygoc2V0dGluZykgPT4ge1xyXG4gICAgICBzZXR0aW5nXHJcbiAgICAgICAgLnNldE5hbWUoJ1RyYWNrIGZvbGRlciByZW5hbWVzIGZvciBzcGVjaWZpYyBmaWxlIG5hbWUnKVxyXG4gICAgICAgIC5zZXREZXNjKFxyXG5cclxuICAgICAgICAgICdJZiBhIE1hcmtkb3duIGZpbGUgbWF0Y2hlcyB0aGlzIGZpbGUgbmFtZSwgc3RvcmUgb2xkIGltbWVkaWF0ZSBwYXJlbnQgZm9sZGVyIG5hbWVzIGluIHRoZSBjb25maWd1cmVkIHByb3BlcnR5IHdoZW4gcGFyZW50IGZvbGRlcnMgYXJlIHJlbmFtZWQuJ1xyXG4gICAgICAgIClcclxuICAgICAgICAuYWRkVGV4dCgodGV4dCkgPT5cclxuICAgICAgICAgIHRleHRcclxuXHJcbiAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcignSW5kZXgnKVxyXG4gICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MudHJhY2tGb2xkZXJSZW5hbWVzKVxyXG4gICAgICAgICAgICAub25DaGFuZ2UoKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MudHJhY2tGb2xkZXJSZW5hbWVzID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICB9XHJcbn1cclxuIiwgIi8qKlxyXG4gKiBDb21wYXRpYmlsaXR5IHV0aWxpdGllcyBmb3Igc2V0dGluZ3NcclxuICogUHJvdmlkZXMgYmFja3dhcmQgY29tcGF0aWJpbGl0eSBmb3IgU2V0dGluZ0dyb3VwIChyZXF1aXJlcyBBUEkgMS4xMS4wKylcclxuICovXHJcbmltcG9ydCB7IFNldHRpbmcsIHJlcXVpcmVBcGlWZXJzaW9uIH0gZnJvbSAnb2JzaWRpYW4nO1xyXG5pbXBvcnQgKiBhcyBPYnNpZGlhbiBmcm9tICdvYnNpZGlhbic7XHJcblxyXG5pbnRlcmZhY2UgU2V0dGluZ0dyb3VwSW5zdGFuY2Uge1xyXG4gIHNldEhlYWRpbmcoaGVhZGluZzogc3RyaW5nKTogdm9pZDtcclxuICBhZGRTZXR0aW5nKGNiOiAoc2V0dGluZzogU2V0dGluZykgPT4gdm9pZCk6IHZvaWQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBJbnRlcmZhY2UgdGhhdCB3b3JrcyB3aXRoIGJvdGggU2V0dGluZ0dyb3VwIGFuZCBmYWxsYmFjayBjb250YWluZXJcclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgU2V0dGluZ3NDb250YWluZXIge1xyXG4gIGFkZFNldHRpbmcoY2I6IChzZXR0aW5nOiBTZXR0aW5nKSA9PiB2b2lkKTogdm9pZDtcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZXMgYSBzZXR0aW5ncyBjb250YWluZXIgdGhhdCB1c2VzIFNldHRpbmdHcm91cCBpZiBhdmFpbGFibGUgKEFQSSAxLjExLjArKSxcclxuICogb3RoZXJ3aXNlIGZhbGxzIGJhY2sgdG8gY3JlYXRpbmcgYSBoZWFkaW5nIGFuZCB1c2luZyB0aGUgY29udGFpbmVyIGRpcmVjdGx5LlxyXG4gKlxyXG4gKiBVc2VzIHJlcXVpcmVBcGlWZXJzaW9uKCcxLjExLjAnKSB0byBjaGVjayBpZiBTZXR0aW5nR3JvdXAgaXMgYXZhaWxhYmxlLlxyXG4gKiBUaGlzIGlzIHRoZSBvZmZpY2lhbCBPYnNpZGlhbiBBUEkgbWV0aG9kIGZvciB2ZXJzaW9uIGNoZWNraW5nLlxyXG4gKlxyXG4gKiBAcGFyYW0gY29udGFpbmVyRWwgLSBUaGUgY29udGFpbmVyIGVsZW1lbnQgZm9yIHNldHRpbmdzXHJcbiAqIEBwYXJhbSBoZWFkaW5nIC0gVGhlIGhlYWRpbmcgdGV4dCBmb3IgdGhlIHNldHRpbmdzIGdyb3VwXHJcbiAqIEBwYXJhbSBtYW5pZmVzdElkIC0gVGhlIHBsdWdpbidzIG1hbmlmZXN0IElEIGZvciBDU1Mgc2NvcGluZyAocmVxdWlyZWQgZm9yIGZhbGxiYWNrIG1vZGUpXHJcbiAqIEByZXR1cm5zIEEgY29udGFpbmVyIHRoYXQgY2FuIGJlIHVzZWQgdG8gYWRkIHNldHRpbmdzXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlU2V0dGluZ3NHcm91cChcclxuICBjb250YWluZXJFbDogSFRNTEVsZW1lbnQsXHJcbiAgaGVhZGluZz86IHN0cmluZyxcclxuICBtYW5pZmVzdElkPzogc3RyaW5nXHJcbik6IFNldHRpbmdzQ29udGFpbmVyIHtcclxuICAvLyBDaGVjayBpZiBTZXR0aW5nR3JvdXAgaXMgYXZhaWxhYmxlIChBUEkgMS4xMS4wKylcclxuICAvLyByZXF1aXJlQXBpVmVyc2lvbiBpcyB0aGUgb2ZmaWNpYWwgT2JzaWRpYW4gQVBJIG1ldGhvZCBmb3IgdmVyc2lvbiBjaGVja2luZ1xyXG4gIGlmIChyZXF1aXJlQXBpVmVyc2lvbignMS4xMS4wJykpIHtcclxuICAgIC8vIFVzZSBTZXR0aW5nR3JvdXAgLSBpdCdzIGd1YXJhbnRlZWQgdG8gZXhpc3QgYXQgcnVudGltZSBpZiByZXF1aXJlQXBpVmVyc2lvbiByZXR1cm5zIHRydWUuXHJcbiAgICAvLyBXZSBhY2Nlc3MgaXQgdmlhIHRoZSBuYW1lc3BhY2UgaW1wb3J0IHRvIGF2b2lkIHJlcXVpcmluZyB0aGUgdHlwZSBpbiBvbGRlciBBUEkgZC50cyBmaWxlcy5cclxuICAgIHR5cGUgT2JzaWRpYW5XaXRoU2V0dGluZ0dyb3VwID0gdHlwZW9mIE9ic2lkaWFuICYge1xyXG4gICAgICBTZXR0aW5nR3JvdXA6IG5ldyAoY29udGFpbmVyRWw6IEhUTUxFbGVtZW50KSA9PiBTZXR0aW5nR3JvdXBJbnN0YW5jZTtcclxuICAgIH07XHJcbiAgICBjb25zdCBPYnNpZGlhblR5cGVkID0gT2JzaWRpYW4gYXMgdW5rbm93biBhcyBPYnNpZGlhbldpdGhTZXR0aW5nR3JvdXA7XHJcbiAgICBjb25zdCBTZXR0aW5nR3JvdXBDdG9yID0gT2JzaWRpYW5UeXBlZC5TZXR0aW5nR3JvdXA7XHJcbiAgICBjb25zdCBncm91cCA9IG5ldyBTZXR0aW5nR3JvdXBDdG9yKGNvbnRhaW5lckVsKTtcclxuICAgIGlmIChoZWFkaW5nKSB7XHJcbiAgICAgIGdyb3VwLnNldEhlYWRpbmcoaGVhZGluZyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBhZGRTZXR0aW5nKGNiOiAoc2V0dGluZzogU2V0dGluZykgPT4gdm9pZCkge1xyXG4gICAgICAgIGdyb3VwLmFkZFNldHRpbmcoY2IpO1xyXG4gICAgICB9LFxyXG4gICAgfTtcclxuICB9IGVsc2Uge1xyXG4gICAgLy8gRmFsbGJhY2sgcGF0aCAoZWl0aGVyIEFQSSA8IDEuMTEuMCBvciBTZXR0aW5nR3JvdXAgbm90IGZvdW5kKVxyXG4gICAgLy8gQWRkIHNjb3BpbmcgY2xhc3MgdG8gY29udGFpbmVyRWwgdG8gc2NvcGUgQ1NTIHRvIG9ubHkgdGhpcyBwbHVnaW4ncyBzZXR0aW5nc1xyXG4gICAgaWYgKG1hbmlmZXN0SWQpIHtcclxuICAgICAgY29udGFpbmVyRWwuYWRkQ2xhc3MoYCR7bWFuaWZlc3RJZH0tc2V0dGluZ3MtY29tcGF0YCk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIEZhbGxiYWNrOiBjcmVhdGUgYSBkZWRpY2F0ZWQgY29udGFpbmVyIHRvIGtlZXAgaGVhZGluZyArIHNldHRpbmdzIHRvZ2V0aGVyXHJcbiAgICBjb25zdCBncm91cEVsID0gY29udGFpbmVyRWwuY3JlYXRlRGl2KCdzZXR0aW5nLWdyb3VwJyk7XHJcbiAgICBpZiAoaGVhZGluZykge1xyXG4gICAgICBjb25zdCBoZWFkaW5nRWwgPSBncm91cEVsLmNyZWF0ZURpdignc2V0dGluZy1ncm91cC1oZWFkaW5nJyk7XHJcbiAgICAgIGhlYWRpbmdFbC5jcmVhdGVFbCgnaDMnLCB7IHRleHQ6IGhlYWRpbmcgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgYWRkU2V0dGluZyhjYjogKHNldHRpbmc6IFNldHRpbmcpID0+IHZvaWQpIHtcclxuICAgICAgICBjb25zdCBzZXR0aW5nID0gbmV3IFNldHRpbmcoZ3JvdXBFbCk7XHJcbiAgICAgICAgY2Ioc2V0dGluZyk7XHJcbiAgICAgIH0sXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuXHJcbiIsICJpbXBvcnQgeyBBcHAsIHN0cmluZ2lmeVlhbWwsIHBhcnNlWWFtbCB9IGZyb20gJ29ic2lkaWFuJztcclxuaW1wb3J0IHsgRmlsZU5hbWVIaXN0b3J5U2V0dGluZ3MgfSBmcm9tICcuLi9zZXR0aW5ncyc7XHJcblxyXG5leHBvcnQgY2xhc3MgSGlzdG9yeVByb2Nlc3NvciB7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIGFwcDogQXBwLFxyXG4gICAgcHJpdmF0ZSBzZXR0aW5nczogRmlsZU5hbWVIaXN0b3J5U2V0dGluZ3NcclxuICApIHsgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIHByb2Nlc3NBbGlhc2VzTWFudWFsbHkocGF0aDogc3RyaW5nLCBxdWV1ZTogU2V0PHN0cmluZz4pOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGNvbnN0IGZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRGaWxlQnlQYXRoKHBhdGgpO1xyXG4gICAgaWYgKCFmaWxlKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCByZWdleGVzOiBSZWdFeHBbXSA9IFtdO1xyXG4gICAgZm9yIChjb25zdCByZWdleFN0ciBvZiB0aGlzLnNldHRpbmdzLmlnbm9yZVJlZ2V4ZXMpIHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICByZWdleGVzLnB1c2gobmV3IFJlZ0V4cChyZWdleFN0cikpO1xyXG4gICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihgSW52YWxpZCBpZ25vcmUgcmVnZXg6ICR7cmVnZXhTdHJ9YCwgZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB0b0FkZDogc3RyaW5nW10gPSBbXTtcclxuICAgIGNvbnN0IGN1cnJlbnRCYXNlbmFtZSA9IGZpbGUuYmFzZW5hbWU7XHJcbiAgICBjb25zdCBjdXJyZW50QmFzZW5hbWVMb3dlciA9IGN1cnJlbnRCYXNlbmFtZS50b0xvd2VyQ2FzZSgpO1xyXG5cclxuICAgIGZvciAoY29uc3QgbmFtZSBvZiBxdWV1ZSkge1xyXG4gICAgICBpZiAocmVnZXhlcy5zb21lKHJlID0+IHJlLnRlc3QobmFtZSkpKSB7XHJcbiAgICAgICAgY29udGludWU7XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgbmFtZUxvd2VyID0gbmFtZS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICBpZiAoXHJcbiAgICAgICAgKHRoaXMuc2V0dGluZ3MuY2FzZVNlbnNpdGl2ZSAmJiBuYW1lID09PSBjdXJyZW50QmFzZW5hbWUpIHx8XHJcbiAgICAgICAgKCF0aGlzLnNldHRpbmdzLmNhc2VTZW5zaXRpdmUgJiYgbmFtZUxvd2VyID09PSBjdXJyZW50QmFzZW5hbWVMb3dlcilcclxuICAgICAgKSB7XHJcbiAgICAgICAgY29udGludWU7XHJcbiAgICAgIH1cclxuICAgICAgdG9BZGQucHVzaChuYW1lKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodG9BZGQubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBSZWFkIGZpbGUgY29udGVudFxyXG4gICAgbGV0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpO1xyXG5cclxuICAgIC8vIFBhcnNlIGZyb250bWF0dGVyXHJcbiAgICBjb25zdCBmcm9udG1hdHRlclJlZ2V4ID0gL14tLS1cXG4oW1xcc1xcU10qPylcXG4tLS1cXG4vO1xyXG4gICAgY29uc3QgbWF0Y2ggPSBjb250ZW50Lm1hdGNoKGZyb250bWF0dGVyUmVnZXgpO1xyXG5cclxuICAgIGxldCBmcm9udG1hdHRlcjogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fTtcclxuICAgIGxldCBmcm9udG1hdHRlclRleHQgPSAnJztcclxuICAgIGxldCBib2R5Q29udGVudCA9IGNvbnRlbnQ7XHJcblxyXG4gICAgaWYgKG1hdGNoKSB7XHJcbiAgICAgIGZyb250bWF0dGVyVGV4dCA9IG1hdGNoWzFdO1xyXG4gICAgICBib2R5Q29udGVudCA9IGNvbnRlbnQuc2xpY2UobWF0Y2hbMF0ubGVuZ3RoKTtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBwYXJzZWQgPSBwYXJzZVlhbWwoZnJvbnRtYXR0ZXJUZXh0KSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiB8IG51bGwgfCB1bmRlZmluZWQ7XHJcbiAgICAgICAgZnJvbnRtYXR0ZXIgPSBwYXJzZWQgJiYgdHlwZW9mIHBhcnNlZCA9PT0gJ29iamVjdCcgPyBwYXJzZWQgOiB7fTtcclxuICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIHBhcnNpbmcgcHJvcGVydGllczpgLCBlKTtcclxuICAgICAgICBmcm9udG1hdHRlciA9IHt9O1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBib2R5Q29udGVudCA9IGNvbnRlbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2V0IG9yIGNyZWF0ZSBhbGlhc2VzIGFycmF5XHJcbiAgICBsZXQgYWxpYXNlcyA9IGZyb250bWF0dGVyW3RoaXMuc2V0dGluZ3MuaGlzdG9yeVByb3BlcnR5TmFtZV07XHJcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkoYWxpYXNlcykpIHtcclxuICAgICAgY29uc3QgaGFzRnJvbnRtYXR0ZXIgPSBPYmplY3Qua2V5cyhmcm9udG1hdHRlcikubGVuZ3RoID4gMDtcclxuICAgICAgaWYgKGhhc0Zyb250bWF0dGVyICYmICF0aGlzLnNldHRpbmdzLmF1dG9DcmVhdGVGcm9udG1hdHRlcikge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBhbGlhc2VzID0gW107XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgYWxpYXNlc0FycmF5ID0gYWxpYXNlcyBhcyBzdHJpbmdbXTtcclxuICAgIGNvbnN0IGV4aXN0aW5nID0gbmV3IFNldDxzdHJpbmc+KFxyXG4gICAgICB0aGlzLnNldHRpbmdzLmNhc2VTZW5zaXRpdmUgPyBhbGlhc2VzQXJyYXkgOiBhbGlhc2VzQXJyYXkubWFwKChhOiBzdHJpbmcpID0+IGEudG9Mb3dlckNhc2UoKSlcclxuICAgICk7XHJcblxyXG4gICAgbGV0IGFkZGVkID0gZmFsc2U7XHJcbiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgdG9BZGQpIHtcclxuICAgICAgY29uc3QgY2hlY2tOYW1lID0gdGhpcy5zZXR0aW5ncy5jYXNlU2Vuc2l0aXZlID8gbmFtZSA6IG5hbWUudG9Mb3dlckNhc2UoKTtcclxuICAgICAgaWYgKCFleGlzdGluZy5oYXMoY2hlY2tOYW1lKSkge1xyXG4gICAgICAgIGFsaWFzZXNBcnJheS5wdXNoKG5hbWUpO1xyXG4gICAgICAgIGV4aXN0aW5nLmFkZChjaGVja05hbWUpO1xyXG4gICAgICAgIGFkZGVkID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmICghYWRkZWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFVwZGF0ZSBmcm9udG1hdHRlclxyXG4gICAgZnJvbnRtYXR0ZXJbdGhpcy5zZXR0aW5ncy5oaXN0b3J5UHJvcGVydHlOYW1lXSA9IGFsaWFzZXNBcnJheTtcclxuXHJcbiAgICAvLyBTdHJpbmdpZnkgZnJvbnRtYXR0ZXJcclxuICAgIGNvbnN0IG5ld0Zyb250bWF0dGVyVGV4dCA9IHN0cmluZ2lmeVlhbWwoZnJvbnRtYXR0ZXIpLnRyaW0oKTtcclxuXHJcbiAgICAvLyBSZWNvbnN0cnVjdCBmaWxlIGNvbnRlbnRcclxuICAgIGNvbnN0IG5ld0NvbnRlbnQgPSBgLS0tXFxuJHtuZXdGcm9udG1hdHRlclRleHR9XFxuLS0tXFxuJHtib2R5Q29udGVudH1gO1xyXG5cclxuICAgIC8vIFdyaXRlIGJhY2sgdG8gZmlsZVxyXG4gICAgYXdhaXQgdGhpcy5hcHAudmF1bHQubW9kaWZ5KGZpbGUsIG5ld0NvbnRlbnQpO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgcHJvY2Vzc0FsaWFzZXMocGF0aDogc3RyaW5nLCBxdWV1ZTogU2V0PHN0cmluZz4pOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGNvbnN0IGZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRGaWxlQnlQYXRoKHBhdGgpO1xyXG4gICAgaWYgKCFmaWxlKSByZXR1cm47XHJcblxyXG4gICAgY29uc3QgcmVnZXhlczogUmVnRXhwW10gPSBbXTtcclxuICAgIGZvciAoY29uc3QgcmVnZXhTdHIgb2YgdGhpcy5zZXR0aW5ncy5pZ25vcmVSZWdleGVzKSB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgcmVnZXhlcy5wdXNoKG5ldyBSZWdFeHAocmVnZXhTdHIpKTtcclxuICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYEludmFsaWQgaWdub3JlIHJlZ2V4OiAke3JlZ2V4U3RyfWAsIGUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdG9BZGQ6IHN0cmluZ1tdID0gW107XHJcbiAgICBjb25zdCBjdXJyZW50QmFzZW5hbWUgPSBmaWxlLmJhc2VuYW1lO1xyXG4gICAgY29uc3QgY3VycmVudEJhc2VuYW1lTG93ZXIgPSBjdXJyZW50QmFzZW5hbWUudG9Mb3dlckNhc2UoKTtcclxuXHJcbiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgcXVldWUpIHtcclxuICAgICAgaWYgKHJlZ2V4ZXMuc29tZShyZSA9PiByZS50ZXN0KG5hbWUpKSkge1xyXG4gICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IG5hbWVMb3dlciA9IG5hbWUudG9Mb3dlckNhc2UoKTtcclxuICAgICAgaWYgKFxyXG4gICAgICAgICh0aGlzLnNldHRpbmdzLmNhc2VTZW5zaXRpdmUgJiYgbmFtZSA9PT0gY3VycmVudEJhc2VuYW1lKSB8fFxyXG4gICAgICAgICghdGhpcy5zZXR0aW5ncy5jYXNlU2Vuc2l0aXZlICYmIG5hbWVMb3dlciA9PT0gY3VycmVudEJhc2VuYW1lTG93ZXIpXHJcbiAgICAgICkge1xyXG4gICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICB9XHJcbiAgICAgIHRvQWRkLnB1c2gobmFtZSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRvQWRkLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVXNlIG1hbnVhbCBwcm9jZXNzaW5nIGZvciBub24tbWQgZmlsZXMsIG9yIGFzIGZhbGxiYWNrXHJcbiAgICBpZiAoZmlsZS5leHRlbnNpb24gIT09ICdtZCcpIHtcclxuICAgICAgYXdhaXQgdGhpcy5wcm9jZXNzQWxpYXNlc01hbnVhbGx5KHBhdGgsIHF1ZXVlKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGF3YWl0IHRoaXMuYXBwLmZpbGVNYW5hZ2VyLnByb2Nlc3NGcm9udE1hdHRlcihmaWxlLCAoZm06IFJlY29yZDxzdHJpbmcsIHVua25vd24+KSA9PiB7XHJcbiAgICAgIGxldCBhbGlhc2VzID0gZm1bdGhpcy5zZXR0aW5ncy5oaXN0b3J5UHJvcGVydHlOYW1lXTtcclxuICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGFsaWFzZXMpKSB7XHJcbiAgICAgICAgLy8gSWYgdGhlcmUncyBubyBmcm9udG1hdHRlciBhdCBhbGwsIHdlIG5lZWQgdG8gY3JlYXRlIGl0IHRvIGFkZCBhbGlhc2VzXHJcbiAgICAgICAgLy8gSWYgdGhlcmUncyBmcm9udG1hdHRlciBidXQgbm8gYWxpYXNlcyBwcm9wZXJ0eSwgcmVzcGVjdCB0aGUgYXV0b0NyZWF0ZUZyb250bWF0dGVyIHNldHRpbmdcclxuICAgICAgICBjb25zdCBoYXNGcm9udG1hdHRlciA9IE9iamVjdC5rZXlzKGZtKS5sZW5ndGggPiAwO1xyXG4gICAgICAgIGlmIChoYXNGcm9udG1hdHRlciAmJiAhdGhpcy5zZXR0aW5ncy5hdXRvQ3JlYXRlRnJvbnRtYXR0ZXIpIHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgYWxpYXNlcyA9IFtdO1xyXG4gICAgICAgIGZtW3RoaXMuc2V0dGluZ3MuaGlzdG9yeVByb3BlcnR5TmFtZV0gPSBhbGlhc2VzO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBhbGlhc2VzQXJyYXkgPSBhbGlhc2VzIGFzIHN0cmluZ1tdO1xyXG4gICAgICBjb25zdCBleGlzdGluZyA9IG5ldyBTZXQ8c3RyaW5nPihcclxuICAgICAgICB0aGlzLnNldHRpbmdzLmNhc2VTZW5zaXRpdmUgPyBhbGlhc2VzQXJyYXkgOiBhbGlhc2VzQXJyYXkubWFwKChhOiBzdHJpbmcpID0+IGEudG9Mb3dlckNhc2UoKSlcclxuICAgICAgKTtcclxuXHJcbiAgICAgIGZvciAoY29uc3QgbmFtZSBvZiB0b0FkZCkge1xyXG4gICAgICAgIGNvbnN0IGNoZWNrTmFtZSA9IHRoaXMuc2V0dGluZ3MuY2FzZVNlbnNpdGl2ZSA/IG5hbWUgOiBuYW1lLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgaWYgKCFleGlzdGluZy5oYXMoY2hlY2tOYW1lKSkge1xyXG4gICAgICAgICAgYWxpYXNlc0FycmF5LnB1c2gobmFtZSk7XHJcbiAgICAgICAgICBleGlzdGluZy5hZGQoY2hlY2tOYW1lKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG4iLCAiZXhwb3J0IGZ1bmN0aW9uIGdldEJhc2VuYW1lKHBhdGg6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgY29uc3QgbmFtZSA9IHBhdGguc3BsaXQoJy8nKS5wb3AoKSB8fCAnJztcclxuICByZXR1cm4gbmFtZS5yZXBsYWNlKC9cXC5bXi8uXSskLywgJycpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0SW1tZWRpYXRlUGFyZW50TmFtZShwYXRoOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gIGNvbnN0IHBhcnRzID0gcGF0aC5zcGxpdCgnLycpO1xyXG4gIHBhcnRzLnBvcCgpOyAvLyBSZW1vdmUgZmlsZSBuYW1lXHJcbiAgcmV0dXJuIHBhcnRzLnBvcCgpIHx8ICcnOyAvLyBHZXQgaW1tZWRpYXRlIHBhcmVudCBmb2xkZXIgbmFtZSBvciAnJyBpZiByb290XHJcbn1cclxuIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxJQUFBQSxtQkFBNkM7OztBQ2F0QyxJQUFNLG1CQUE0QztBQUFBLEVBQ3ZELHFCQUFxQjtBQUFBLEVBQ3JCLGVBQWUsQ0FBQyxNQUFNLGNBQWMsaUJBQWlCO0FBQUEsRUFDckQsZ0JBQWdCO0FBQUEsRUFDaEIsZUFBZTtBQUFBLEVBQ2YsdUJBQXVCO0FBQUEsRUFDdkIsZ0JBQWdCLENBQUM7QUFBQSxFQUNqQixnQkFBZ0IsQ0FBQztBQUFBLEVBQ2pCLGdCQUFnQixDQUFDLElBQUk7QUFBQSxFQUNyQixvQkFBb0I7QUFBQSxFQUNwQixxQkFBcUI7QUFDdkI7OztBQ3hCQSxJQUFBQyxtQkFBOEM7OztBQ0k5QyxzQkFBMkM7QUFDM0MsZUFBMEI7QUEwQm5CLFNBQVMsb0JBQ2QsYUFDQSxTQUNBLFlB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T0FBTztBQUFBLE1BQ2pDO0FBQUEsSUFDRjtBQUVBLFFBQUksZUFBZTtBQUVqQixVQUFJLGNBQWMsY0FBYyxHQUFHO0FBQ2pDLGVBQU8sYUFBYSxjQUFjLFNBQVM7QUFBQSxNQUM3QztBQUdBLGdCQUFVLE1BQU0sS0FBSyxjQUFjLEtBQUssRUFBRSxDQUFDO0FBQUEsSUFDN0M7QUFHQSxVQUFNLFFBQVE7QUFBQSxNQUNaLE9BQU8sb0JBQUksSUFBWSxDQUFDLE9BQU8sQ0FBQztBQUFBLE1BQ2hDLFdBQVc7QUFBQSxNQUNYLGFBQWEsUUFBUTtBQUFBLElBQ3ZCO0FBR0EsVUFBTSxZQUFZLE9BQU8sV0FBVyxNQUFNO0FBQ3hDLFlBQU0sWUFBWTtBQUNoQixZQUFJO0FBQ0YsZ0JBQU0sS0FBSyxpQkFBaUIsZUFBZSxNQUFNLGFBQWEsTUFBTSxLQUFLO0FBQUEsUUFDM0UsU0FBUyxPQUFPO0FBQ2Qsa0JBQVEsTUFBTSw2QkFBNkIsS0FBSztBQUFBLFFBQ2xEO0FBQ0EsYUFBSyxZQUFZLE9BQU8sTUFBTSxXQUFXO0FBQUEsTUFDM0MsR0FBRztBQUFBLElBQ0wsR0FBRyxLQUFLLFNBQVMsaUJBQWlCLEdBQUk7QUFFdEMsU0FBSyxZQUFZLElBQUksUUFBUSxNQUFNLEtBQUs7QUFBQSxFQUMxQztBQUNGOyIsCiAgIm5hbWVzIjogWyJpbXBvcnRfb2JzaWRpYW4iLCAiaW1wb3J0X29ic2lkaWFuIiwgImltcG9ydF9vYnNpZGlhbiJdCn0K
